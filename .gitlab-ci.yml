py27:
  image: python:2.7
  tags:
    - infradev
  script:
    - pip install -U --pre -i https://pypi.infinidat.com/simple -e .[testing] infinisim
    - pytest

py34:
  image: python:3.4
  tags:
    - infradev
  script:
    - pip install -U --pre -i https://pypi.infinidat.com/simple -e .[testing] infinisim
    - pytest

py35:
  image: python:3.5
  tags:
    - infradev
  script:
    - pip install -U --pre -i https://pypi.infinidat.com/simple -e .[testing] infinisim
    - pytest

pypi:
  image: python
  tags:
    - infradev
  stage: deploy
  only:
    - master
    - tags
    - /^(dev|stable)-\d+(\.\d+)*$/
  script:
    - curl -sL http://goto/pypi_register | python - -v ./
