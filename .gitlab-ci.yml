py27:
  image: python:2.7
  tags:
    - infradev
  script:
    - pip install -U --pre -i https://pypi.infinidat.com/simple -e .
    - pip install -U --pre -i https://pypi.infinidat.com/simple -r test_requirements.txt infinisim
    - py.test

py34:
  image: python:3.4
  tags:
    - infradev
  script:
    - pip install -U --pre -i https://pypi.infinidat.com/simple -e .
    - pip install -U --pre -i https://pypi.infinidat.com/simple -r test_requirements.txt infinisim
    - py.test

py35:
  image: python:3.5
  tags:
    - infradev
  script:
    - pip install -U --pre -i https://pypi.infinidat.com/simple -e .
    - pip install -U --pre -i https://pypi.infinidat.com/simple -r test_requirements.txt infinisim
    - py.test

pypi:
  image: python:3
  tags:
    - infradev
  stage: deploy
  only:
    - master
    - tags
  script:
    - curl -sL http://goto/pypi_register | python - -v ./
